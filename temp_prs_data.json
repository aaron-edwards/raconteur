[{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8242","repository_url":"https://api.github.com/repos/squareup/cash-supportal","labels_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8242/labels{/name}","comments_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8242/comments","events_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8242/events","html_url":"https://github.com/squareup/cash-supportal/pull/8242","id":2131490103,"node_id":"PR_kwDOEjQwIc5mtTGR","number":8242,"title":"rename getExact to getCustomer","user":{"login":"stephengeller","id":25747336,"node_id":"MDQ6VXNlcjI1NzQ3MzM2","avatar_url":"https://avatars.githubusercontent.com/u/25747336?v=4","gravatar_id":"","url":"https://api.github.com/users/stephengeller","html_url":"https://github.com/stephengeller","followers_url":"https://api.github.com/users/stephengeller/followers","following_url":"https://api.github.com/users/stephengeller/following{/other_user}","gists_url":"https://api.github.com/users/stephengeller/gists{/gist_id}","starred_url":"https://api.github.com/users/stephengeller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stephengeller/subscriptions","organizations_url":"https://api.github.com/users/stephengeller/orgs","repos_url":"https://api.github.com/users/stephengeller/repos","events_url":"https://api.github.com/users/stephengeller/events{/privacy}","received_events_url":"https://api.github.com/users/stephengeller/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-02-13T05:24:51Z","updated_at":"2024-02-13T05:33:10Z","closed_at":"2024-02-13T05:33:09Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/squareup/cash-supportal/pulls/8242","html_url":"https://github.com/squareup/cash-supportal/pull/8242","diff_url":"https://github.com/squareup/cash-supportal/pull/8242.diff","patch_url":"https://github.com/squareup/cash-supportal/pull/8242.patch","merged_at":"2024-02-13T05:33:09Z"},"body":"## What\r\n\r\nThis PR changes the method `getExact` to `getCustomer` to better describe the current behaviour (fetching customer data from CAPS). This adjustment is aimed at improving the readability and maintainability of our code.\r\n\r\n## Why\r\n\r\n`getExact` is no longer fit for purpose given that we are directly calling CAPS for data rather than a combination of Franklin and a local DB. `getCustomer` fits better.","reactions":{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8242/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8241","repository_url":"https://api.github.com/repos/squareup/cash-supportal","labels_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8241/labels{/name}","comments_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8241/comments","events_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8241/events","html_url":"https://github.com/squareup/cash-supportal/pull/8241","id":2131471934,"node_id":"PR_kwDOEjQwIc5mtPUT","number":8241,"title":"Revert \"chore(customer-manager): Update method names for clarity and future integration\"","user":{"login":"stephengeller","id":25747336,"node_id":"MDQ6VXNlcjI1NzQ3MzM2","avatar_url":"https://avatars.githubusercontent.com/u/25747336?v=4","gravatar_id":"","url":"https://api.github.com/users/stephengeller","html_url":"https://github.com/stephengeller","followers_url":"https://api.github.com/users/stephengeller/followers","following_url":"https://api.github.com/users/stephengeller/following{/other_user}","gists_url":"https://api.github.com/users/stephengeller/gists{/gist_id}","starred_url":"https://api.github.com/users/stephengeller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stephengeller/subscriptions","organizations_url":"https://api.github.com/users/stephengeller/orgs","repos_url":"https://api.github.com/users/stephengeller/repos","events_url":"https://api.github.com/users/stephengeller/events{/privacy}","received_events_url":"https://api.github.com/users/stephengeller/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-02-13T05:05:41Z","updated_at":"2024-02-13T05:17:28Z","closed_at":"2024-02-13T05:17:27Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/squareup/cash-supportal/pulls/8241","html_url":"https://github.com/squareup/cash-supportal/pull/8241","diff_url":"https://github.com/squareup/cash-supportal/pull/8241.diff","patch_url":"https://github.com/squareup/cash-supportal/pull/8241.patch","merged_at":"2024-02-13T05:17:27Z"},"body":"Reverts squareup/cash-supportal#8213","reactions":{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8241/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8241/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/squareup/cash-support-articles/issues/531","repository_url":"https://api.github.com/repos/squareup/cash-support-articles","labels_url":"https://api.github.com/repos/squareup/cash-support-articles/issues/531/labels{/name}","comments_url":"https://api.github.com/repos/squareup/cash-support-articles/issues/531/comments","events_url":"https://api.github.com/repos/squareup/cash-support-articles/issues/531/events","html_url":"https://github.com/squareup/cash-support-articles/pull/531","id":2131177098,"node_id":"PR_kwDOH8dLIM5msQls","number":531,"title":"chore: increase threshold for critical latency monitors","user":{"login":"stephengeller","id":25747336,"node_id":"MDQ6VXNlcjI1NzQ3MzM2","avatar_url":"https://avatars.githubusercontent.com/u/25747336?v=4","gravatar_id":"","url":"https://api.github.com/users/stephengeller","html_url":"https://github.com/stephengeller","followers_url":"https://api.github.com/users/stephengeller/followers","following_url":"https://api.github.com/users/stephengeller/following{/other_user}","gists_url":"https://api.github.com/users/stephengeller/gists{/gist_id}","starred_url":"https://api.github.com/users/stephengeller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stephengeller/subscriptions","organizations_url":"https://api.github.com/users/stephengeller/orgs","repos_url":"https://api.github.com/users/stephengeller/repos","events_url":"https://api.github.com/users/stephengeller/events{/privacy}","received_events_url":"https://api.github.com/users/stephengeller/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-02-12T23:35:57Z","updated_at":"2024-02-13T04:42:44Z","closed_at":"2024-02-13T04:42:43Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/squareup/cash-support-articles/pulls/531","html_url":"https://github.com/squareup/cash-support-articles/pull/531","diff_url":"https://github.com/squareup/cash-support-articles/pull/531.diff","patch_url":"https://github.com/squareup/cash-support-articles/pull/531.patch","merged_at":"2024-02-13T04:42:43Z"},"body":"This PR introduces an adjustment to the critical latency thresholds for RPC monitors within our Datadog configuration. The aim is to better align these thresholds with our current operational standards and improve the accuracy of alerting for service health issues. This should help minimise false positives while ensuring we're promptly alerted to genuine service degradations.\r\n\r\nhttps://block.atlassian.net/browse/CHANNELS-223\r\n\r\n### Changes:\r\n\r\n1. **Increased Critical Latency Threshold for General RPC Monitoring**:\r\n - Previously, the critical latency threshold was set to `1500ms`. This has now been doubled to `3000ms` to reflect more realistic service operation times and reduce noise from alerts that aren't indicative of actual problems.\r\n\r\n### Notes:\r\n- **Impact**: These changes are expected to reduce the number of critical alerts generated for expected or non-critical latency variations, allowing our teams to focus more on alerts that signify real issues.\r\n- **Rollout**: Upon merging, these changes will be applied automatically to our Datadog configuration. No immediate action is required from development teams, but awareness of these adjustments is beneficial.","reactions":{"url":"https://api.github.com/repos/squareup/cash-support-articles/issues/531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/squareup/cash-support-articles/issues/531/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8234","repository_url":"https://api.github.com/repos/squareup/cash-supportal","labels_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8234/labels{/name}","comments_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8234/comments","events_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8234/events","html_url":"https://github.com/squareup/cash-supportal/pull/8234","id":2129480480,"node_id":"PR_kwDOEjQwIc5mmb0K","number":8234,"title":"test: set up missing customers in tests","user":{"login":"stephengeller","id":25747336,"node_id":"MDQ6VXNlcjI1NzQ3MzM2","avatar_url":"https://avatars.githubusercontent.com/u/25747336?v=4","gravatar_id":"","url":"https://api.github.com/users/stephengeller","html_url":"https://github.com/stephengeller","followers_url":"https://api.github.com/users/stephengeller/followers","following_url":"https://api.github.com/users/stephengeller/following{/other_user}","gists_url":"https://api.github.com/users/stephengeller/gists{/gist_id}","starred_url":"https://api.github.com/users/stephengeller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stephengeller/subscriptions","organizations_url":"https://api.github.com/users/stephengeller/orgs","repos_url":"https://api.github.com/users/stephengeller/repos","events_url":"https://api.github.com/users/stephengeller/events{/privacy}","received_events_url":"https://api.github.com/users/stephengeller/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-02-12T06:08:48Z","updated_at":"2024-02-13T00:59:31Z","closed_at":"2024-02-13T00:59:30Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/squareup/cash-supportal/pulls/8234","html_url":"https://github.com/squareup/cash-supportal/pull/8234","diff_url":"https://github.com/squareup/cash-supportal/pull/8234.diff","patch_url":"https://github.com/squareup/cash-supportal/pull/8234.patch","merged_at":"2024-02-13T00:59:30Z"},"body":"#### Changes\r\nThis PR ensures all tests that require a (fake) customer to be setup before testing have one.\r\n\r\n#### Why is this change occurring?\r\nWe are planning to introduce a change to the CustomerManager where `getExact` will throw an error when the customer does not exist, restoring old behaviour before we migrated to CAPS. This PR allows us to make that change more easily, as these tests would all fail once that change occurs.\r\n\r\n#### Information for Reviewers:\r\n- Reviewers should ensure that the CustomerSimulator integration does not alter the fundamental assertions and outcomes of the tests. \r\n- Attention should be paid to the seamless integration of the simulator setup within the test lifecycle, particularly looking out for missing or redundant simulator invocations.","reactions":{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8234/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8234/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8213","repository_url":"https://api.github.com/repos/squareup/cash-supportal","labels_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8213/labels{/name}","comments_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8213/comments","events_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8213/events","html_url":"https://github.com/squareup/cash-supportal/pull/8213","id":2124308015,"node_id":"PR_kwDOEjQwIc5mVILL","number":8213,"title":"chore(customer-manager): Update method names for clarity and future integration","user":{"login":"stephengeller","id":25747336,"node_id":"MDQ6VXNlcjI1NzQ3MzM2","avatar_url":"https://avatars.githubusercontent.com/u/25747336?v=4","gravatar_id":"","url":"https://api.github.com/users/stephengeller","html_url":"https://github.com/stephengeller","followers_url":"https://api.github.com/users/stephengeller/followers","following_url":"https://api.github.com/users/stephengeller/following{/other_user}","gists_url":"https://api.github.com/users/stephengeller/gists{/gist_id}","starred_url":"https://api.github.com/users/stephengeller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stephengeller/subscriptions","organizations_url":"https://api.github.com/users/stephengeller/orgs","repos_url":"https://api.github.com/users/stephengeller/repos","events_url":"https://api.github.com/users/stephengeller/events{/privacy}","received_events_url":"https://api.github.com/users/stephengeller/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-02-08T03:51:44Z","updated_at":"2024-02-13T03:35:25Z","closed_at":"2024-02-13T03:35:24Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/squareup/cash-supportal/pulls/8213","html_url":"https://github.com/squareup/cash-supportal/pull/8213","diff_url":"https://github.com/squareup/cash-supportal/pull/8213.diff","patch_url":"https://github.com/squareup/cash-supportal/pull/8213.patch","merged_at":"2024-02-13T03:35:24Z"},"body":"<!-- Describe _why_ this change is occurring, as well as any noteworthy details about the change. -->\r\n### Overview\r\nThis PR focuses on renaming the method `getExact` to `getCustomer` in the `CustomerManager` class. The main intent of this rename is to make the method's purpose clearer and align its name with its functionality.\r\n\r\n[Notion card](https://block.atlassian.net/jira/software/c/projects/CHANNELS/boards/4687?assignee=unassigned&assignee=62a14611be336c006fe9290f&selectedIssue=CHANNELS-15)\r\n[Slack thread](https://cash.slack.com/archives/C02TT9B6P1Q/p1691389567441559)\r\n\r\n### Rationale\r\nBefore migrating to `CAPS` to get customer data, the original `getExact` method threw a runtime error if the customer did not exist. The function now always returns a CustomerSnapshot because we are now always asking CAPS for information that we turn into a Snapshot, rather than ask Franklin/our local DB, where the customer might not exist.\r\n\r\nThis is a problem because we can mistakenly think a customer exists when it doesn’t, and make assumptions and decisions based on that.\r\n\r\nSupportal can call CAPS any customer token (valid or not) and get a response that currently does not indicate at all whether that customer even exists or not. Supportal even makes an assumption that it exists and sets the customer’s region to the default region (USA) even though that customer may not exist.\r\n\r\nWeird behaviour can be observed in [this test](https://github.com/squareup/cash-supportal/blob/f8769d30a0031acc585e6bce21fcbd121fffe910/service/src/test/kotlin/com/squareup/cash/supportal/chat/writingassistant/v1/actions/GetWritingAssistantV1SupportedQuickTextsActionTest.kt#L44), for example, which passes despite no customer existing.\r\n\r\nSolution\r\n\r\n[This thread with the CAPS owners in #cash-customer-data-future](https://cash.slack.com/archives/C02TT9B6P1Q/p1691389567441559) discusses some options.\r\n\r\n> One way you can check for existence is to check whether the JOINED_DATE facet has a value. That’s one of the first facets that are created for a customer\r\n\r\nI believe it's more intuitive and safer to force users to handle the potential non-existence of a customer explicitly. Therefore, while we've replaced instances of `getExact` with `getCustomer` in this PR, we've also introduced a new method, `getCustomerOrNull`, which will return `null` if the customer doesn't exist. This new method ensures that users explicitly handle cases where a customer might not be present in our system, and we can begin to use it throughout Supportal to handle non-existent customers more carefully.\r\n\r\n### Future Work\r\nThe `getCustomerOrNull` method has been introduced in this PR but hasn't been utilised yet. The plan is to integrate this method in a subsequent PR, keeping the current PR mainly focused on the rename.\r\n\r\n### Notes for Reviewers\r\n- The primary change in this PR is the method rename. Please ensure consistency in the method's usage across all modified files.\r\n- While reviewing, note that the functionality remains largely unchanged. The main shift is in the method naming and the introduction of the `getCustomerOrNull` method for future use.\r\n\r\n### Deployment Notes\r\n- After merging, this change should be tested thoroughly in staging before promoting to production.\r\n- Monitor for any potential issues related to customer data fetching after deployment, especially given the method rename.\r\n","reactions":{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8213/timeline","performed_via_github_app":null,"state_reason":null,"score":1},{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8208","repository_url":"https://api.github.com/repos/squareup/cash-supportal","labels_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8208/labels{/name}","comments_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8208/comments","events_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8208/events","html_url":"https://github.com/squareup/cash-supportal/pull/8208","id":2124162772,"node_id":"PR_kwDOEjQwIc5mUpBf","number":8208,"title":"downgrade Franklin.PruneSupportCriteriaTree log to warn","user":{"login":"stephengeller","id":25747336,"node_id":"MDQ6VXNlcjI1NzQ3MzM2","avatar_url":"https://avatars.githubusercontent.com/u/25747336?v=4","gravatar_id":"","url":"https://api.github.com/users/stephengeller","html_url":"https://github.com/stephengeller","followers_url":"https://api.github.com/users/stephengeller/followers","following_url":"https://api.github.com/users/stephengeller/following{/other_user}","gists_url":"https://api.github.com/users/stephengeller/gists{/gist_id}","starred_url":"https://api.github.com/users/stephengeller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stephengeller/subscriptions","organizations_url":"https://api.github.com/users/stephengeller/orgs","repos_url":"https://api.github.com/users/stephengeller/repos","events_url":"https://api.github.com/users/stephengeller/events{/privacy}","received_events_url":"https://api.github.com/users/stephengeller/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-02-08T00:48:51Z","updated_at":"2024-02-08T02:33:01Z","closed_at":"2024-02-08T02:33:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/squareup/cash-supportal/pulls/8208","html_url":"https://github.com/squareup/cash-supportal/pull/8208","diff_url":"https://github.com/squareup/cash-supportal/pull/8208.diff","patch_url":"https://github.com/squareup/cash-supportal/pull/8208.patch","merged_at":"2024-02-08T02:33:00Z"},"body":"<!-- Describe _why_ this change is occurring, as well as any noteworthy details about the change. -->\r\nThis change is occurring to better handle exceptions in our `CriteriaTreePruner` and `ContentfulSupportTreePruner` classes. \r\n\r\nAdjusting the log level from error to warning for these exceptions enhances clarity and efficiency. These exceptions are caught and handled, indicating they're part of expected behaviour rather than critical failures. Currently, they clutter our error logs without necessitating action, leading to operational noise and distracting from genuine issues.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/squareup/cash-supportal/issues/8208/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/squareup/cash-supportal/issues/8208/timeline","performed_via_github_app":null,"state_reason":null,"score":1}]
